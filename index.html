<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Markdown2PDF Pro</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.11/dist/purify.min.js"></script>
  <style>
    :root {
      --bg-primary: #1a1f2b;
      --bg-secondary: #222837;
      --bg-panel: #252b3a;
      --bg-toolbar: #2d3445;
      --border-color: #3a4154;
      --text-primary: #e6e9f0;
      --text-secondary: #a0a8bc;
      --accent-color: #4d9de0;
      --accent-hover: #3a85c9;
      --preview-bg: #ffffff;
      --preview-text: #1a1f2b;
      --modal-bg: #1e2433;
      --modal-border: #353d4e;
      --code-bg: #2d3445;
      --code-border: #3a4154;
      --success-color: #10b981;
      --error-color: #ef4444;
      --warning-color: #f59e0b;
      --quote-color: #a0a8bc;
      --search-bg: #2a3141;
      --search-border: #4a5265;
      --theme-icon: #ffc107;
      --notification-shadow: 0 4px 12px rgba(0,0,0,0.25);
      --panel-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
      --modal-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
      --dot-bg: #e3f2fd;
      --dot-border: #2c7be5;
    }
    :root[data-theme="light"] {
      --bg-primary: #f8f9fa;
      --bg-secondary: #e9ecef;
      --bg-panel: #ffffff;
      --bg-toolbar: #f1f3f5;
      --border-color: #dee2e6;
      --text-primary: #212529;
      --text-secondary: #495057;
      --accent-color: #2c7be5;
      --accent-hover: #2463c2;
      --preview-bg: #ffffff;
      --preview-text: #212529;
      --modal-bg: #ffffff;
      --modal-border: #dee2e6;
      --code-bg: #f8f9fa;
      --code-border: #dee2e6;
      --success-color: #10b981;
      --error-color: #ef4444;
      --warning-color: #f59e0b;
      --quote-color: #6c757d;
      --search-bg: #ffffff;
      --search-border: #ced4da;
      --theme-icon: #6c757d;
      --notification-shadow: 0 4px 12px rgba(0,0,0,0.1);
      --panel-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --modal-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
      --dot-bg: #f0f7ff;
      --dot-border: #2c7be5;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; }
    body {
      background-color: var(--bg-primary);
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      transition: background-color 0.3s ease;
      line-height: 1.5;
    }
    .header {
      background-color: var(--bg-toolbar);
      border-bottom: 1px solid var(--border-color);
      padding: 0.7rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 100;
    }
    .header-title {
      font-size: 1.4rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      color: var(--accent-color);
    }
    .header-buttons { display: flex; gap: 0.8rem; align-items: center; }
    .header-btn {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.95rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.6rem;
      transition: all 0.25s ease;
      font-weight: 500;
    }
    .header-btn:hover {
      background: rgba(77, 157, 224, 0.2);
      border-color: var(--accent-color);
      color: var(--accent-color);
    }
    .theme-toggle-btn {
      background: var(--bg-toolbar);
      border: 1px solid var(--border-color);
      width: 44px;
      height: 44px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.25s ease;
      color: var(--theme-icon);
      font-size: 1.2rem;
    }
    .theme-toggle-btn:hover {
      background: var(--accent-color);
      color: white;
      transform: rotate(15deg);
    }
    .main-container {
      flex: 1;
      display: flex;
      padding: 1rem;
      gap: 1.2rem;
      overflow: hidden;
    }
    .content-area {
      display: flex;
      width: 100%;
      height: 100%;
      gap: 1.2rem;
    }
    .panel {
      background: var(--bg-panel);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: var(--panel-shadow);
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .toolbar {
      background: var(--bg-toolbar);
      border-bottom: 1px solid var(--border-color);
      padding: 0.7rem 1rem;
      display: flex;
      gap: 0.7rem;
      flex-wrap: wrap;
      justify-content: space-between;
    }
    .tool-btn {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 0.45rem 0.9rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      min-width: 90px;
      font-weight: 500;
    }
    .tool-btn:hover {
      background: rgba(77, 157, 224, 0.25);
      border-color: var(--accent-color);
      color: var(--accent-color);
    }
    .tool-btn.danger {
      background: rgba(229, 115, 115, 0.15);
      border-color: #d32f2f;
      color: #ffcdd2;
    }
    .tool-btn.danger:hover {
      background: rgba(211, 47, 47, 0.25);
      border-color: #c62828;
      color: white;
    }
    .editor-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .editor {
      flex: 1;
      padding: 1.4rem;
      font-family: 'Consolas', 'Courier New', monospace;
      font-size: 15px;
      line-height: 1.6;
      resize: none;
      background: var(--bg-primary);
      color: var(--text-primary);
      border: none;
      outline: none;
      caret-color: var(--accent-color);
      overflow: auto;
      width: 100%;
      height: 100%;
    }
    .preview-header {
      background: var(--bg-toolbar);
      border-bottom: 1px solid var(--border-color);
      padding: 0.7rem 1.2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      flex-wrap: wrap;
      gap: 0.8rem;
    }
    .font-size-control { display: flex; align-items: center; gap: 0.8rem; }
    .font-size-select {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 0.4rem 0.7rem;
      border-radius: 6px;
      font-size: 0.95rem;
      min-width: 75px;
    }
    .document-input-group {
      display: flex;
      align-items: center;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
    }
    .document-input-group input {
      background: transparent;
      border: none;
      color: var(--text-primary);
      padding: 0.5rem 0.9rem;
      font-size: 1rem;
      outline: none;
      width: 160px;
      font-weight: 500;
    }
    .document-extension {
      color: var(--text-secondary);
      padding: 0.5rem 0.9rem;
      font-size: 1rem;
      border-left: 1px solid var(--border-color);
      min-width: 45px;
      text-align: center;
    }
    .download-btn {
      background: linear-gradient(45deg, var(--accent-color), #3a85c9);
      color: white;
      border: none;
      padding: 0.55rem 1.3rem;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.7rem;
      transition: all 0.25s ease;
      font-weight: 600;
      min-width: 120px;
      justify-content: center;
    }
    .download-btn:hover {
      background: linear-gradient(45deg, var(--accent-hover), #2a75b5);
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    .preview {
      flex: 1;
      padding: 1.5rem;
      overflow: auto;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      background: var(--bg-secondary);
    }
    .preview-content {
      background: var(--preview-bg);
      color: var(--preview-text);
      padding: 2.5rem;
      line-height: 1.7;
      font-size: 15px;
      border-radius: 14px;
      box-shadow: 0 6px 30px rgba(0, 0, 0, 0.1);
      width: 80%;
      max-width: 850px;
      min-width: 320px;
    }
    .preview-content h1 {
      font-size: 2.3em;
      margin-bottom: 0.6em;
      border-bottom: 2px solid #eee;
      padding-bottom: 0.4em;
      font-weight: 700;
      line-height: 1.2;
      color: #1a1f2b;
    }
    .preview-content h2 {
      font-size: 1.8em;
      margin: 1.3em 0 0.7em;
      font-weight: 600;
      color: #2c3e50;
    }
    .preview-content h3 {
      font-size: 1.45em;
      margin: 1.1em 0 0.6em;
      font-weight: 600;
      color: #2c3e50;
    }
    .preview-content p { margin: 1em 0; line-height: 1.7; }
    .preview-content ul, .preview-content ol {
      padding-left: 2rem;
      margin: 1.2rem 0;
    }
    .preview-content li { margin-bottom: 0.6rem; line-height: 1.65; }
    .preview-content blockquote {
      border-left: 4px solid var(--accent-color);
      padding-left: 1.4rem;
      color: var(--quote-color);
      font-style: italic;
      margin: 1.6rem 0;
      background: rgba(77, 157, 224, 0.06);
      padding: 1.1rem 1.4rem;
      border-radius: 0 8px 8px 0;
    }
    .preview-content code:not(pre code) {
      background: var(--code-bg);
      border: 1px solid var(--code-border);
      border-radius: 4px;
      padding: 0.25rem 0.5rem;
      font-family: 'Consolas', 'Courier New', monospace;
      font-size: 0.95em;
      color: #e06c75;
    }
    .preview-content pre {
      background: var(--code-bg);
      border: 1px solid var(--code-border);
      border-radius: 10px;
      padding: 1.4rem;
      margin: 1.6rem 0;
      overflow-x: auto;
      font-family: 'Consolas', 'Courier New', monospace;
      font-size: 0.95em;
      line-height: 1.55;
    }
    .preview-content pre code {
      background: none;
      border: none;
      padding: 0;
      font-size: inherit;
      color: var(--preview-text);
      line-height: 1.55;
    }
    .preview-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.6rem 0;
      border-radius: 10px;
      overflow: hidden;
    }
    .preview-content th, .preview-content td {
      border: 1px solid #ddd;
      padding: 0.9rem 1.2rem;
      text-align: left;
      line-height: 1.45;
    }
    .preview-content th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #2c3e50;
    }
    .preview-content tr:nth-child(even) {
      background-color: rgba(0, 0, 0, 0.02);
    }
    .footer-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem 1.8rem;
      font-size: 0.95rem;
      color: var(--text-secondary);
      border-top: 1px solid var(--border-color);
      background: var(--bg-toolbar);
      flex-shrink: 0;
      margin-top: 1rem;
    }
    .footer-made-by { font-weight: 600; color: var(--accent-color); display: flex; align-items: center; gap: 0.5rem; }
    .footer-slogan { font-weight: 500; color: var(--text-secondary); font-style: italic; }
    #notification {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: white;
      color: #1a1f2b;
      padding: 16px 24px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      gap: 14px;
      z-index: 2000;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      transform: translateX(450px);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      max-width: 400px;
      border-left: 5px solid var(--success-color);
    }
    #notification.show {
      transform: translateX(0);
      opacity: 1;
    }
    #notification.error { border-left-color: var(--error-color); background: #fff5f5; }
    #notification.warning { border-left-color: var(--warning-color); background: #fff9e6; }
    #notification i { font-size: 1.4rem; }
    #notification.error i { color: var(--error-color); }
    #notification.warning i { color: var(--warning-color); }
    #notification.success i { color: var(--success-color); }
    #notification button {
      background: none;
      border: none;
      color: #6c757d;
      font-size: 1.3rem;
      cursor: pointer;
      padding: 0 6px;
      display: flex;
      margin-left: 10px;
      border-radius: 5px;
      transition: all 0.2s;
    }
    #notification button:hover {
      color: var(--text-primary);
      background: rgba(0,0,0,0.06);
    }
    .notification-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      background: var(--accent-color);
      border-radius: 0 0 14px 14px;
      width: 100%;
      animation: progress 5s linear forwards;
    }
    @keyframes progress {
      from { width: 100%; }
      to { width: 0%; }
    }
    .pdf-loader {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(10, 12, 20, 0.85);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      backdrop-filter: blur(5px);
    }
    .pdf-loader.active {
      opacity: 1;
      pointer-events: all;
    }
    .loader-content {
      background: var(--modal-bg);
      padding: 45px;
      border-radius: 22px;
      box-shadow: 0 18px 45px rgba(0,0,0,0.38);
      text-align: center;
      max-width: 420px;
      width: 92%;
      border: 1px solid var(--modal-border);
    }
    .loader-spinner {
      position: relative;
      width: 80px;
      height: 80px;
      margin: 0 auto 28px;
    }
    .loader-spinner-inner {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 5px solid var(--border-color);
      border-top-color: var(--accent-color);
      animation: spin 0.8s linear infinite;
      box-shadow: 0 0 18px rgba(77, 157, 224, 0.5);
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .loader-text {
      font-size: 24px;
      color: var(--text-primary);
      font-weight: 700;
      margin-top: 12px;
      letter-spacing: -0.6px;
    }
    .loader-subtext {
      font-size: 16px;
      color: var(--text-secondary);
      margin-top: 10px;
      font-weight: 400;
    }
    .dot-diagram-container {
      text-align: center;
      margin: 2rem 0;
      background: var(--dot-bg);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid var(--dot-border);
      overflow: hidden;
      box-shadow: 0 3px 15px rgba(0,0,0,0.08);
    }
    .katex-display { margin: 1.4em 0 !important; }
    .katex { font-size: 1.2em; }
    @media (max-width: 1100px) {
      .content-area { flex-direction: column; }
      .preview-content { width: 95%; padding: 2rem 1.8rem; }
      .main-container { padding: 0.8rem; }
      .header { padding: 0.6rem 1rem; }
      .header-title { font-size: 1.25rem; }
      .document-input-group { max-width: 190px; }
      .document-input-group input { width: 130px; font-size: 0.95rem; }
      .document-extension { font-size: 0.95rem; min-width: 40px; }
      .font-size-select { min-width: 70px; font-size: 0.9rem; padding: 0.35rem 0.6rem; }
      .tool-btn { min-width: 80px; padding: 0.4rem 0.7rem; font-size: 0.88rem; }
    }
    @media (max-width: 768px) {
      .preview-content { width: 98%; padding: 1.8rem 1.5rem; font-size: 14.5px; }
      .preview-content h1 { font-size: 2em; }
      .preview-content h2 { font-size: 1.65em; }
      .editor { font-size: 14.5px; padding: 1.2rem; }
      .tool-btn { min-width: 75px; padding: 0.4rem 0.65rem; font-size: 0.85rem; }
      .header-buttons { gap: 0.5rem; }
      .header-btn { padding: 0.45rem 0.8rem; font-size: 0.88rem; }
      .theme-toggle-btn { width: 40px; height: 40px; font-size: 1.1rem; }
      .download-btn { width: 100%; padding: 0.6rem; font-size: 1.05rem; }
      .preview-header { flex-direction: column; align-items: stretch; gap: 12px; }
      .font-size-control, .document-actions { width: 100%; justify-content: space-between; }
      .footer-container { flex-direction: column; gap: 10px; text-align: center; }
    }
    @media (max-width: 480px) {
      .preview-content { padding: 1.6rem 1.3rem; font-size: 14px; }
      .preview-content h1 { font-size: 1.85em; }
      .preview-content h2 { font-size: 1.5em; }
      .editor { font-size: 14px; padding: 1rem; }
      .tool-btn { min-width: 70px; padding: 0.38rem 0.6rem; font-size: 0.82rem; }
      .header-title { font-size: 1.15rem; }
      .document-input-group { max-width: 160px; }
      .document-input-group input { width: 100px; font-size: 0.9rem; }
      .document-extension { font-size: 0.9rem; min-width: 38px; padding: 0.45rem 0.7rem; }
      .header { padding: 0.55rem 0.9rem; }
    }
    ::-webkit-scrollbar { width: 10px; height: 10px; }
    ::-webkit-scrollbar-track { background: var(--bg-primary); border-radius: 5px; }
    ::-webkit-scrollbar-thumb { 
      background: var(--border-color); 
      border-radius: 5px;
      border: 2px solid var(--bg-primary);
    }
    ::-webkit-scrollbar-thumb:hover { background: #5a6275; }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-title">
      <i class="fas fa-file-pdf"></i> Markdown2PDF Pro
    </div>
    <div class="header-buttons">
      <button class="header-btn" id="infoBtn">
        <i class="fas fa-info-circle"></i> <span>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
      </button>
      <button class="header-btn" id="authorBtn">
        <i class="fas fa-heart"></i> <span>–ê–≤—Ç–æ—Ä</span>
      </button>
      <div class="theme-toggle-btn" id="themeToggle">
        <i class="fas fa-moon"></i>
      </div>
    </div>
  </div>

  <div class="main-container">
    <div class="content-area">
      <div class="panel">
        <div class="toolbar">
          <div style="display:flex;gap:0.7rem;flex-wrap:wrap;">
            <button class="tool-btn" id="boldBtn">
              <i class="fas fa-bold"></i> <span>–ñ–∏—Ä–Ω—ã–π</span>
            </button>
            <button class="tool-btn" id="italicBtn">
              <i class="fas fa-italic"></i> <span>–ö—É—Ä—Å–∏–≤</span>
            </button>
            <button class="tool-btn" id="linkBtn">
              <i class="fas fa-link"></i> <span>–°—Å—ã–ª–∫–∞</span>
            </button>
            <button class="tool-btn" id="tableBtn">
              <i class="fas fa-table"></i> <span>–¢–∞–±–ª–∏—Ü–∞</span>
            </button>
            <button class="tool-btn" id="searchBtn">
              <i class="fas fa-search"></i> <span>–ü–æ–∏—Å–∫</span>
            </button>
            <button class="tool-btn danger" id="clearBtn">
              <i class="fas fa-trash-alt"></i> <span>–û—á–∏—Å—Ç–∏—Ç—å</span>
            </button>
          </div>
          <div style="display:flex;gap:0.7rem;flex-wrap:wrap;">
            <button class="tool-btn" id="listBtn">
              <i class="fas fa-list"></i> <span>–°–ø–∏—Å–æ–∫</span>
            </button>
            <button class="tool-btn" id="codeBtn">
              <i class="fas fa-code"></i> <span>–ö–æ–¥</span>
            </button>
            <button class="tool-btn" id="quoteBtn">
              <i class="fas fa-quote-right"></i> <span>–¶–∏—Ç–∞—Ç–∞</span>
            </button>
            <button class="tool-btn" id="breakBtn">
              <i class="fas fa-scissors"></i> <span>–†–∞–∑—Ä—ã–≤</span>
            </button>
          </div>
        </div>
        <div class="editor-container">
          <textarea class="editor" id="markdownEditor" placeholder="–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –≤–∞—à –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown..."># –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Markdown2PDF Pro!

–≠—Ç–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ Markdown –≤ PDF —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º—É–ª –∏ –¥–∏–∞–≥—Ä–∞–º–º.

## üìê –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã

–ò–Ω–ª–∞–π–Ω —Ñ–æ—Ä–º—É–ª–∞: $E = mc^2$

–ë–ª–æ—á–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞:
$$
\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$

–°–∏—Å—Ç–µ–º–∞ —É—Ä–∞–≤–Ω–µ–Ω–∏–π:
$$
\begin{cases}
x + y = 5 \\ 
2x - y = 1
\end{cases}
$$

## üìä –¢–∞–±–ª–∏—Ü–∞

| –°–∏–Ω—Ç–∞–∫—Å–∏—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----------|----------|--------|
| –ó–∞–≥–æ–ª–æ–≤–æ–∫ | –í–µ—Ä—Ö–Ω—è—è —Å—Ç—Ä–æ–∫–∞ | `# –ó–∞–≥–æ–ª–æ–≤–æ–∫` |
| –°–ø–∏—Å–æ–∫    | –ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π | `- –≠–ª–µ–º–µ–Ω—Ç` |
| –°—Å—ã–ª–∫–∞    | –ì–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∞  | `[—Ç–µ–∫—Å—Ç](url)` |

## üí° –¶–∏—Ç–∞—Ç–∞

> "–õ—É—á—à–∏–π —Å–ø–æ—Å–æ–± –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –±—É–¥—É—â–µ–µ ‚Äî –∏–∑–æ–±—Ä–µ—Å—Ç–∏ –µ–≥–æ."
> ‚Äî –ê–ª–∞–Ω –ö–µ–π

## üîó –°—Å—ã–ª–∫–∞

[GitHub –∞–≤—Ç–æ—Ä–∞](https://github.com/Aurum2347)

## üìÅ –ë–ª–æ–∫-—Å—Ö–µ–º–∞ DOT

```dot
digraph G {
  rankdir=LR;
  node [shape=rectangle, style=filled, fillcolor="#e3f2fd", color="#2c7be5"];
  Start [label="–ù–∞—á–∞–ª–æ", fillcolor="#bbdefb"];
  Process [label="–û–±—Ä–∞–±–æ—Ç–∫–∞"];
  Decision [shape=diamond, label="–£—Å–ª–æ–≤–∏–µ?", fillcolor="#e8f5e9"];
  Action1 [label="–î–µ–π—Å—Ç–≤–∏–µ 1", fillcolor="#e8f5e9"];
  Action2 [label="–î–µ–π—Å—Ç–≤–∏–µ 2", fillcolor="#fff3e0"];
  End [label="–ö–æ–Ω–µ—Ü", fillcolor="#ffcdd2"];
  
  Start -> Process;
  Process -> Decision;
  Decision -> Action1 [label="–î–∞"];
  Decision -> Action2 [label="–ù–µ—Ç"];
  Action1 -> End;
  Action2 -> End;
}
```

## üìÑ –†–∞–∑—Ä—ã–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–¢–µ–∫—Å—Ç –¥–æ —Ä–∞–∑—Ä—ã–≤–∞...

---

–¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ —Ä–∞–∑—Ä—ã–≤–∞. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤!</textarea>
        </div>
      </div>
      
      <div class="panel">
        <div class="preview-header">
          <div class="font-size-control">
            <label for="fontSizeSelect"><i class="fas fa-text-height"></i> –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞:</label>
            <select class="font-size-select" id="fontSizeSelect">
              <option value="13">13px</option>
              <option value="15" selected>15px</option>
              <option value="17">17px</option>
              <option value="19">19px</option>
            </select>
          </div>
          <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap;">
            <div class="document-input-group">
              <input type="text" id="documentName" value="document" maxlength="50">
              <div class="document-extension">.pdf</div>
            </div>
            <button class="download-btn" id="downloadPdf">
              <i class="fas fa-download"></i> <span>–°–∫–∞—á–∞—Ç—å PDF</span>
            </button>
          </div>
        </div>
        <div class="preview">
          <div class="preview-content" id="previewContent"></div>
        </div>
        <div class="footer-container">
          <div>
            <span class="footer-status">
              <span style="display:inline-block;width:10px;height:10px;background:#10b981;border-radius:50%;margin-right:8px;"></span> –ì–æ—Ç–æ–≤–æ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É
            </span>
          </div>
          <div>
            <span class="footer-made-by">
              <i class="fas fa-code"></i> By Aurum2347
            </span>
          </div>
          <div>
            <span class="footer-slogan">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="notification">
    <i class="fas fa-check-circle success"></i>
    <span id="notificationText">–î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!</span>
    <button onclick="closeNotification()">&times;</button>
    <div class="notification-progress"></div>
  </div>

  <div class="pdf-loader" id="pdfLoader">
    <div class="loader-content">
      <div class="loader-spinner">
        <div class="loader-spinner-inner"></div>
      </div>
      <div class="loader-text">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF</div>
      <div class="loader-subtext">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/lib/marked.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let graphvizInstance = null;
    let editor = document.getElementById('markdownEditor');
    let preview = document.getElementById('previewContent');
    let themeToggle = document.getElementById('themeToggle');
    let fontSizeSelect = document.getElementById('fontSizeSelect');
    let documentNameInput = document.getElementById('documentName');
    let downloadBtn = document.getElementById('downloadPdf');
    let pdfLoader = document.getElementById('pdfLoader');
    let notification = document.getElementById('notification');
    let previewTimeout = null;
    let downloadCount = parseInt(localStorage.getItem('downloadCount') || '0');
    let totalChars = parseInt(localStorage.getItem('totalChars') || '0');

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º—ã
    function loadTheme() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      updateThemeIcon(savedTheme);
    }

    function updateThemeIcon(theme) {
      const icon = themeToggle.querySelector('i');
      if (theme === 'dark') {
        icon.className = 'fas fa-moon';
        icon.title = '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É';
      } else {
        icon.className = 'fas fa-sun';
        icon.title = '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ç–µ–º–Ω—É—é —Ç–µ–º—É';
      }
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    themeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme);
      showNotification(newTheme === 'dark' ? '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞' : '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞', 'success', 2000);
      updatePreview();
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ KaTeX
    async function loadKaTeX() {
      return new Promise((resolve) => {
        if (window.katex && window.renderMathInElement) {
          resolve();
          return;
        }
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js';
        script.onload = () => {
          const renderScript = document.createElement('script');
          renderScript.src = 'https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js';
          renderScript.onload = () => resolve();
          document.head.appendChild(renderScript);
        };
        document.head.appendChild(script);
      });
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ Graphviz —á–µ—Ä–µ–∑ WebAssembly (—Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ!)
    async function loadGraphviz() {
      try {
        if (window.Graphviz) {
          graphvizInstance = await window.Graphviz.load();
          console.log('Graphviz –∑–∞–≥—Ä—É–∂–µ–Ω');
          return;
        }
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/@hpcc-js/wasm@2.15.0/dist/graphviz.umd.min.js';
        await new Promise((resolve, reject) => {
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        });
        if (window.Graphviz) {
          graphvizInstance = await window.Graphviz.load();
          console.log('Graphviz –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ WebAssembly');
        }
      } catch (error) {
        console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Graphviz:', error);
        showNotification('–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –º–æ–≥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞–∫ –∫–æ–¥', 'warning', 4000);
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    function updatePreview() {
      clearTimeout(previewTimeout);
      previewTimeout = setTimeout(() => {
        const text = editor.value;
        try {
          // –ü–∞—Ä—Å–∏–º Markdown
          const html = marked.parse(text, {
            breaks: true,
            gfm: true,
            mangle: false,
            headerIds: false
          });
          
          // –û—á–∏—â–∞–µ–º HTML
          const clean = DOMPurify.sanitize(html, {
            USE_PROFILES: { html: true },
            ADD_TAGS: ['svg', 'g', 'path', 'circle', 'rect', 'polygon', 'polyline', 'line', 'ellipse', 'text', 'image'],
            ADD_ATTR: ['d', 'x', 'y', 'width', 'height', 'r', 'cx', 'cy', 'rx', 'ry', 'points', 'x1', 'y1', 'x2', 'y2', 'transform', 'fill', 'stroke', 'stroke-width', 'viewBox', 'xmlns', 'style', 'class', 'href', 'preserveAspectRatio']
          });
          
          preview.innerHTML = clean;
          
          // –†–µ–Ω–¥–µ—Ä–∏–º —Ñ–æ—Ä–º—É–ª—ã KaTeX
          if (window.renderMathInElement) {
            renderMathInElement(preview, {
              delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '\\[', right: '\\]', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false}
              ],
              throwOnError: false,
              errorColor: '#cc0000'
            });
          }
          
          // –†–µ–Ω–¥–µ—Ä–∏–º DOT –¥–∏–∞–≥—Ä–∞–º–º—ã
          renderDotDiagrams();
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
          totalChars = text.length;
          localStorage.setItem('totalChars', totalChars.toString());
          
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:', e);
          preview.innerHTML = `<p style="color: var(--error-color); padding: 20px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border-left: 4px solid var(--error-color);">
            <strong>–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ Markdown:</strong> ${e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}
          </p>`;
        }
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
        preview.style.fontSize = fontSizeSelect.value + 'px';
      }, 300);
    }

    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ DOT –¥–∏–∞–≥—Ä–∞–º–º
    async function renderDotDiagrams() {
      await new Promise(resolve => setTimeout(resolve, 50));
      
      const containers = preview.querySelectorAll('pre > code.language-dot, pre.language-dot > code, pre.language-dot, code.language-dot');
      
      for (const container of containers) {
        const dotCode = container.textContent.trim();
        if (!dotCode) continue;
        
        const diagramContainer = document.createElement('div');
        diagramContainer.className = 'dot-diagram-container';
        
        try {
          if (graphvizInstance) {
            const svg = await graphvizInstance.layout(dotCode, 'svg', 'dot');
            diagramContainer.innerHTML = svg;
            
            // –£–ª—É—á—à–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ SVG
            const svgEl = diagramContainer.querySelector('svg');
            if (svgEl) {
              svgEl.style.maxWidth = '100%';
              svgEl.style.height = 'auto';
              svgEl.style.display = 'block';
              svgEl.style.margin = '0 auto';
              
              // –°—Ç–∏–ª–∏–∑—É–µ–º —É–∑–ª—ã
              svgEl.querySelectorAll('ellipse, polygon, rect').forEach(node => {
                node.style.stroke = '#2c7be5';
                node.style.strokeWidth = '1.8';
                if (!node.style.fill || ['#ffffff', 'white', '#fff'].includes(node.style.fill.toLowerCase())) {
                  node.style.fill = '#e3f2fd';
                }
              });
            }
          } else {
            throw new Error('Graphviz –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
          }
        } catch (error) {
          console.warn('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã:', error);
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥ –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
          diagramContainer.innerHTML = `
            <div style="text-align:left;padding:15px;">
              <div style="font-weight:bold;color:var(--dot-border);margin-bottom:10px;display:flex;align-items:center;gap:8px;">
                <i class="fas fa-diagram-project"></i> Graphviz –¥–∏–∞–≥—Ä–∞–º–º–∞ (–∫–æ–¥)
              </div>
              <pre style="background:#f8f9fa;border-radius:8px;padding:15px;font-family:monospace;font-size:14px;overflow:auto;margin-top:10px;">${escapeHtml(dotCode)}</pre>
              <div style="margin-top:12px;padding:12px;background:#e3f2fd;border-radius:6px;font-size:14px;color:#1565c0;">
                <strong>üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –î–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è 5-10 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏.
              </div>
            </div>
          `;
        }
        
        // –ó–∞–º–µ–Ω—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        if (container.parentElement && container.parentElement.tagName === 'PRE') {
          container.parentElement.replaceWith(diagramContainer);
        } else {
          container.replaceWith(diagramContainer);
        }
      }
    }

    function escapeHtml(unsafe) {
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF
    async function downloadPDF() {
      let filename = documentNameInput.value.trim()
        .replace(/[<>:"/\\|?*]/g, '_')
        .replace(/\s+/g, '_')
        .substring(0, 50);
      
      if (!filename) filename = 'document';
      
      if (!editor.value.trim()) {
        showNotification('–ù–µ–ª—å–∑—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É—Å—Ç–æ–π –¥–æ–∫—É–º–µ–Ω—Ç', 'error', 3000);
        return;
      }
      
      pdfLoader.classList.add('active');
      
      try {
        // –ö–ª–æ–Ω–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        const clone = preview.cloneNode(true);
        clone.style.width = '595pt';
        clone.style.padding = '40pt 35pt';
        clone.style.margin = '0';
        clone.style.boxSizing = 'border-box';
        clone.style.fontSize = `${fontSizeSelect.value}px`;
        clone.style.color = '#1a1f2b';
        clone.style.background = 'white';
        clone.style.boxShadow = 'none';
        
        // –£–±–∏—Ä–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        clone.querySelectorAll('.dot-diagram-title, .dot-note').forEach(el => el.remove());
        
        // –£–ª—É—á—à–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –ø–µ—á–∞—Ç–∏
        clone.querySelectorAll('table').forEach(table => {
          table.style.width = '100%';
          table.style.borderCollapse = 'collapse';
          table.querySelectorAll('th, td').forEach(cell => {
            cell.style.border = '1px solid #ddd';
            cell.style.padding = '8px';
          });
        });
        
        // –í—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        const tempContainer = document.createElement('div');
        tempContainer.style.position = 'absolute';
        tempContainer.style.left = '-9999px';
        tempContainer.style.top = '0';
        tempContainer.appendChild(clone);
        document.body.appendChild(tempContainer);
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
        const options = {
          margin: [25, 20, 25, 20],
          filename: `${filename}.pdf`,
          html2canvas: {
            scale: 2,
            useCORS: true,
            logging: false,
            backgroundColor: '#ffffff',
            allowTaint: true
          },
          jsPDF: { unit: 'pt', format: 'a4', orientation: 'portrait' },
          pagebreak: { mode: ['css', 'legacy'], avoid: ['img', 'svg', '.katex-display', '.dot-diagram-container', 'pre', 'blockquote'] }
        };
        
        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º
        await html2pdf().set(options).from(clone).save();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        downloadCount++;
        localStorage.setItem('downloadCount', downloadCount.toString());
        
        showNotification(`–î–æ–∫—É–º–µ–Ω—Ç "${filename}.pdf" —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!`, 'success', 5000);
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
        showNotification(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error', 5000);
      } finally {
        // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        if (tempContainer && tempContainer.parentNode) {
          tempContainer.parentNode.removeChild(tempContainer);
        }
        pdfLoader.classList.remove('active');
      }
    }

    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showNotification(message, type = 'success', duration = 5000) {
      const notificationText = document.getElementById('notificationText');
      const icon = notification.querySelector('i');
      
      notificationText.textContent = message;
      notification.className = '';
      notification.classList.add('show');
      
      switch(type) {
        case 'success':
          notification.classList.add('success');
          icon.className = 'fas fa-check-circle success';
          notification.style.borderLeftColor = 'var(--success-color)';
          break;
        case 'error':
          notification.classList.add('error');
          icon.className = 'fas fa-exclamation-circle error';
          notification.style.borderLeftColor = 'var(--error-color)';
          break;
        case 'warning':
          notification.classList.add('warning');
          icon.className = 'fas fa-exclamation-triangle warning';
          notification.style.borderLeftColor = 'var(--warning-color)';
          break;
      }
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
      const progressBar = notification.querySelector('.notification-progress');
      if (progressBar) {
        progressBar.style.animation = 'none';
        setTimeout(() => {
          progressBar.style.animation = 'progress 5s linear forwards';
        }, 10);
      }
      
      // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ
      if (duration > 0) {
        setTimeout(() => {
          notification.classList.remove('show');
        }, duration);
      }
    }

    function closeNotification() {
      notification.classList.remove('show');
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
    function applyFormat(type) {
      const start = editor.selectionStart;
      const end = editor.selectionEnd;
      const selected = editor.value.substring(start, end);
      let newText = '';
      
      switch(type) {
        case 'bold': newText = selected ? `**${selected}**` : `**–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç**`; break;
        case 'italic': newText = selected ? `*${selected}*` : `*–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç*`; break;
        case 'link': newText = selected ? `[${selected}](https://example.com)` : `[—Ç–µ–∫—Å—Ç —Å—Å—ã–ª–∫–∏](https://example.com)`; break;
        case 'list': newText = selected ? selected.split('\n').map(l => `- ${l}`).join('\n') : `- –≠–ª–µ–º–µ–Ω—Ç 1\n- –≠–ª–µ–º–µ–Ω—Ç 2`; break;
        case 'code': newText = selected ? `\`\`\`\n${selected}\n\`\`\`` : `\`\`\`\n// –ö–æ–¥ –∑–¥–µ—Å—å\n\`\`\``; break;
        case 'quote': newText = selected ? selected.split('\n').map(l => `> ${l}`).join('\n') : `> –¶–∏—Ç–∞—Ç–∞`; break;
        case 'pageBreak': newText = '\n---\n'; break;
      }
      
      if (type === 'pageBreak') {
        editor.value = editor.value.substring(0, start) + newText + editor.value.substring(end);
        editor.selectionStart = editor.selectionEnd = start + newText.length;
      } else {
        editor.value = editor.value.substring(0, start) + newText + editor.value.substring(end);
        editor.selectionStart = start + (newText.startsWith('`') ? 3 : (newText.startsWith('[') ? 1 : 2));
        editor.selectionEnd = editor.selectionStart + (selected || (type === 'bold' ? 10 : type === 'italic' ? 13 : type === 'link' ? 11 : 8));
      }
      
      editor.focus();
      updatePreview();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
    document.getElementById('boldBtn').addEventListener('click', () => applyFormat('bold'));
    document.getElementById('italicBtn').addEventListener('click', () => applyFormat('italic'));
    document.getElementById('linkBtn').addEventListener('click', () => applyFormat('link'));
    document.getElementById('listBtn').addEventListener('click', () => applyFormat('list'));
    document.getElementById('codeBtn').addEventListener('click', () => applyFormat('code'));
    document.getElementById('quoteBtn').addEventListener('click', () => applyFormat('quote'));
    document.getElementById('breakBtn').addEventListener('click', () => applyFormat('pageBreak'));
    document.getElementById('searchBtn').addEventListener('click', () => {
      const searchTerm = prompt('–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ:');
      if (searchTerm && searchTerm.trim()) {
        const index = editor.value.toLowerCase().indexOf(searchTerm.toLowerCase());
        if (index !== -1) {
          editor.focus();
          editor.setSelectionRange(index, index + searchTerm.length);
          editor.scrollTop = editor.scrollHeight * (index / editor.value.length);
          showNotification(`–ù–∞–π–¥–µ–Ω–æ: "${searchTerm}"`, 'success', 3000);
        } else {
          showNotification(`–¢–µ–∫—Å—Ç "${searchTerm}" –Ω–µ –Ω–∞–π–¥–µ–Ω`, 'warning', 3000);
        }
      }
    });
    document.getElementById('clearBtn').addEventListener('click', () => {
      if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –¥–æ–∫—É–º–µ–Ω—Ç? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
        editor.value = `# –ù–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç\n\n–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å...\n\n## –ü—Ä–∏–º–µ—Ä—ã\n\n### –§–æ—Ä–º—É–ª–∞\n$$\n\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}\n$$\n\n### –î–∏–∞–≥—Ä–∞–º–º–∞\n\`\`\`dot\ndigraph G {\n  A -> B;\n  B -> C;\n}\n\`\`\``;
        updatePreview();
        showNotification('–î–æ–∫—É–º–µ–Ω—Ç –æ—á–∏—â–µ–Ω', 'success', 2000);
      }
    });
    document.getElementById('tableBtn').addEventListener('click', () => {
      const table = `| –ó–∞–≥–æ–ª–æ–≤–æ–∫ 1 | –ó–∞–≥–æ–ª–æ–≤–æ–∫ 2 | –ó–∞–≥–æ–ª–æ–≤–æ–∫ 3 |\n|-------------|-------------|-------------|\n| –Ø—á–µ–π–∫–∞ 1    | –Ø—á–µ–π–∫–∞ 2    | –Ø—á–µ–π–∫–∞ 3    |\n| –Ø—á–µ–π–∫–∞ 4    | –Ø—á–µ–π–∫–∞ 5    | –Ø—á–µ–π–∫–∞ 6    |`;
      const start = editor.selectionStart;
      const prefix = (editor.value.trim() === '' || start === 0) ? '' : '\n\n';
      editor.value = editor.value.substring(0, start) + prefix + table + editor.value.substring(start);
      editor.focus();
      editor.selectionStart = editor.selectionEnd = start + prefix.length + table.length;
      updatePreview();
      showNotification('–¢–∞–±–ª–∏—Ü–∞ –≤—Å—Ç–∞–≤–ª–µ–Ω–∞', 'success', 2500);
    });
    document.getElementById('infoBtn').addEventListener('click', () => {
      alert('Markdown2PDF Pro\n\n‚Ä¢ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Markdown\n‚Ä¢ –§–æ—Ä–º—É–ª—ã LaTeX —á–µ—Ä–µ–∑ KaTeX\n‚Ä¢ –î–∏–∞–≥—Ä–∞–º–º—ã Graphviz (DOT)\n‚Ä¢ –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞\n‚Ä¢ –°–≤–µ—Ç–ª–∞—è/—Ç—ë–º–Ω–∞—è —Ç–µ–º–∞\n‚Ä¢ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π ‚Äî –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ');
    });
    document.getElementById('authorBtn').addEventListener('click', () => {
      window.open('https://github.com/Aurum2347', '_blank');
    });
    downloadBtn.addEventListener('click', downloadPDF);
    fontSizeSelect.addEventListener('change', updatePreview);
    documentNameInput.addEventListener('input', (e) => {
      e.target.value = e.target.value
        .replace(/[<>:"/\\|?*]/g, '_')
        .replace(/\s+/g, '_')
        .substring(0, 50) || 'document';
    });
    
    // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        applyFormat('bold');
      } else if ((e.ctrlKey || e.metaKey) && e.key === 'i') {
        e.preventDefault();
        applyFormat('italic');
      } else if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        applyFormat('link');
      } else if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
        e.preventDefault();
        document.getElementById('searchBtn').click();
      } else if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        downloadPDF();
      }
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', async () => {
      loadTheme();
      editor.addEventListener('input', updatePreview);
      updatePreview();
      await loadKaTeX();
      await loadGraphviz();
      
      // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      setTimeout(() => {
        showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Markdown2PDF Pro! –ù–∞–∂–º–∏—Ç–µ Ctrl+S –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.', 'success', 6000);
      }, 800);
    });
  </script>
</body>
</html>
